
p(a,f(b)).
p(c,f(d)).
p(e,f(g)).

r(?X,?Y) :- p(?Z,f(?X)), ?Z[foo -> ?Y].

%tst1(?X,?Y,?Z) :-
	// stuff before a hypothetical
	p(?X,f(?Y)),
	// a hypothetical possibility query
	<> (t_insert{c[foo->g(y)], a[foo->bar]}, r(?Y,?Z)),
	// some stuff after
	t_insert{cde[efg->k]},
	p(a,?),
	// print results
	write('\ntst1: X'=?X)@_plg,
	write('  Y'=?Y)@_plg,
	write('  Z'=?Z)@_plg.

%tst4(?X,?Y,?Z) :-
	// stuff before a hypothetical
	p(?X,f(?Y)),
	// a hypothetical IMpossibility query
	~<> (t_insert{c[foo->g(y)], a[foo->bar]}, r(e,?Z)),
	// some stuff after
	t_insert{cde[efg->k]},
	p(a,?),
	// print results
	write('\ntst4: X'=?X)@_plg,
	write('  Y'=?Y)@_plg,
	write('  Z'=?Z)@_plg.

// print the results from the mixed hypothetical/non-hypothetical query
?- %tst1(?X,?Y,?Z).

// c[foo->g(y)] was inserted hypothetically, so it goes
?- write('\ntst2: ')@_plg,
	if c[foo->g(y)] then
           writeln(failed)@_plg
	else
           writeln(succeded)@_plg.

// cde[efg->k] was not inserted hypotheticaly, so it stays
?- write('tst3: ')@_plg,
	if ?[efg->?] then
           writeln(succeded)@_plg
	else
           writeln(failed)@_plg.

// an impossibility query
?- %tst4(?X,?Y,?Z).
