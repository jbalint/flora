#! /bin/sh

if [ -e binary-distribution.txt ]; then
    echo ""
    echo +++++ This seems to be a binary distribution of FLORA-2.
    echo +++++ Please use floraconfig to configure it:
    echo +++++   floraconfig path-for-/XSB/bin/xsb
    echo ""
    exit 1
fi

if [ "$1" = clean ] ; then
    make clean
    exit 0
fi

if [ -n "$1" -a "$1" != all -a "$1" != top -a "$1" != core -a "$1" != system -a "$1" != base -a "$1" != libs -a "$1" != misc ] ; then
    echo ""
    echo +++++ Argument 1 must be a Makefile target such as all, top, core, etc.
    echo ""
    exit 1
fi

# if the first argument is -S, use subsumptive tabling
# if the first argument is -I, use incremental tabling
default_tabling=flrincludes/.flora_default_tabling
echo "" > $default_tabling
if test "$1" = "-S"; then
    echo "#define FLORA_SUBSUMPTIVE_TABLING" > $default_tabling
    shift
fi
if test "$1" = "-I"; then
    echo "#define FLORA_INCREMENTAL_TABLING" > $default_tabling
    shift
fi
if test "$1" = "-S"; then
    echo "#define FLORA_SUBSUMPTIVE_TABLING" > $default_tabling
    shift
fi

# Arg 1 is a make target. One of: all (default), system, base, top

if [ -z "$2" ] ; then
    prologcmd=none
else
    prologcmd=$2
fi

./floraconfig "$prologcmd" compiling || exit 1
# Set PROLOG to the absolute path that was generated by flrconfig.P
. .flora_paths

chmod 755 ./runflora ./runflora*.bat

if [ -d /cygdrive/c  ]; then
    # It is CYGWIN
    rm -f cc/*.dll cc/*.lib cc/*.exp cc/*.obj cc/*.def cc/*.a cc/*.o
    rm -f cc/prolog2hilog.xwam
fi

make $1 PROLOG=$PROLOG


chmod a+r * */*

