#! /bin/sh

# if the first argument is -S, use subsumptive tabling
# if the first argument is -I, use incremental tabling
default_tabling=flrincludes/.flora_default_tabling
echo "" > $default_tabling
if test "$1" = "-S"; then
    echo "#define FLORA_SUBSUMPTIVE_TABLING" > $default_tabling
    shift
fi
if test "$1" = "-I"; then
    echo "#define FLORA_INCREMENTAL_TABLING" > $default_tabling
    shift
fi
if test "$1" = "-S"; then
    echo "#define FLORA_SUBSUMPTIVE_TABLING" > $default_tabling
    shift
fi

# Arg 1 is a make target. One of: all (default), system, base, top

./setflora "$2" compiling || exit 1
# Set PROLOG to the absolute path that was generated by flrconfig.P
. .flora_paths

chmod 755 ./runflora ./runflora*.bat

if [ -d /cygdrive/c  ]; then
    # It is CYGWIN
    rm -f cc/*.dll cc/*.lib cc/*.exp cc/*.obj cc/*.def cc/*.a cc/*.o
    rm -f cc/prolog2hilog.xwam
fi

if [ ! -e binary-distribution.txt ]; then
    make $1 PROLOG=$PROLOG
fi


chmod a+r * */*

