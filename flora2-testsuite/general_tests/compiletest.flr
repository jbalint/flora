
#include "standard.h"

?- flora_set_maxwarnings(50)@_plg(flrutils).

%test :-
	(File[exists(compiletest_old)]@_io -->> File[unlink(compiletest_old)]@_io; true),
	(flora_running_as(flora2)@_plg(flrporting) -->>
	    File[link(compiletest_flora_old,compiletest_old)]@_io
	;  File[link(compiletest_ergo_old,compiletest_old)]@_io
        ),
	flora_set_maxerrors(30)@_plg(flrutils),
	flora_set_maxwarnings(50)@_plg(flrutils),
	file_reopen(temp,w,STDERR,?_)@_plg(file_io),
	file_reopen(temp1,w,STDWARN,?_)@_plg(file_io),
	(_compile(compile_control) ; true),
	file_close(STDWARN)@_plg(file_io),
	file_close(STDERR)@_plg(file_io),
	open(file(temp1)@_plg,read,?Port1)@_plg,
	open(file(temp)@_plg,append,?Port2)@_plg,
	copyIOport(?Port1,?Port2)@_plg(file_io),
	close(?Port1)@_plg,
	close(?Port2)@_plg,
	flora_file_op(unlink,temp1)@_plg(flrporting).



