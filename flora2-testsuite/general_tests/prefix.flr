


?- newmodule{foo}.
//?- tt[%silk#cccc]@foo.
//?- tt[%silk#cccc].
tt[%silk#cccc] :- true.

?- insert{tt[%silk#cccc]}.
tt[%silk#cccc(aaa)].

?- insert{tt[%silk#aaa(kkk)]@foo}.
?- insert{tt[%silk#cccc]@foo}.
rrr[%silk#www].

C[%silk#aaa(b)].
C[silk#aaa(b)].
%silk#pppp(?Y)(?X):-?X[%silk#aaa(?Y)].
%silk#rrrr(?Y)(?X):-?X[%silk#aaa(?Y)]@foo.

%silk#aaaaa(aa)(bb,cc).
bbbbbb[%silk#ccccc(ooo)(pppp)].

// the next group are just to make sure they compile.
// mod is an infix operator, and it does not compose right with the # operator.
// so we modify arrange_arguments to make sure the mis-composition is corrected.
// Also, tests that builtin identifier works right with %...#...
:- iriprefix swrlb = "http://www.w3.org/2003/11/swrlb#" .
swrlb#mod(?output):- foo(?output).
swrlb#_mod(?output):- foo(?output).
%swrlb#mod(?output):- foo(?output).
%swrlb#_mod(?output):- foo(?output).


%tst1 :- write(tst1)@_plg, write(' ')@_plg,
	 ?L= collectset{?Z| ?X[%silk#aaa(?Y)], ?Z=(?X,?Y)},
	 writeln(?L)@_plg.
%tst2 :- write(tst2)@_plg, write(' ')@_plg,
	 ?L = collectset{?Z| %silk#pppp(?y)(?x), ?Z= (?x,?y)},
	 writeln(?L)@_plg.
%tst3 :- write(tst3)@_plg, write(' ')@_plg,
	?L = setof{?Z| %silk#rrrr(?y)(?x), ?Z=(?x,?y)},
	 writeln(?L)@_plg.
%tst4 :- write(tst4)@_plg,
	 if tt[%silk#cccc]@foo then writeln(' ok')@_plg
         else writeln(' bummer')@_plg.
%tst5 :- write(tst5)@_plg, write(' ')@_plg,
	 ?L = setof{?X| rrr[%?X]},
	 writeln(?L)@_plg.
%tst6 :- write(tst6)@_plg,
	 if rrr[%silk#www] then writeln(' ok')@_plg
         else writeln(' bummer')@_plg.
%tst7 :- write(tst7)@_plg,
	 write(' ')@_plg,
	 ?L = setof{?X|tt[%?X]},
	 flora_write_oid(?L)@_plg(flrdecode),
	 nl@_plg.

%tst8 :- write(tst8)@_plg,
	 if %silk#aaaaa(aa)(bb,cc) then writeln(' ok')@_plg
         else writeln(' bummer')@_plg.
%tst9 :- write(tst9)@_plg,
	 if bbbbbb[%silk#ccccc(ooo)(pppp)] then writeln(' ok')@_plg
         else writeln(' bummer')@_plg.

%tst10 :- write(tst10)@_plg,
	  insert{mary[salary->15],ppp(mary.salary@main),%qqq(mary.salary@main)},
	  if (ppp(mary.salary@main), %qqq(mary.salary@main))
          then writeln(' ok')@_plg
          else writeln(' bummer')@_plg.

%aabcde.
%fdegh.
%qprs :- %fdegh@main.

%tst11 :- write(tst11)@_plg,
	  insert{%pqwer :- %fdegh},
	  if (%aabcde,%qprs,%pqwer)
          then writeln(' ok')@_plg
          else writeln(' bummer')@_plg.

%"foo"^^bar.
"foo"^^bar.
%"http://www.w3.org/2003/11/swrlb#add"^^_iri :- %"foo"^^bar.
"http://www.w3.org/2003/11/swrlb#add"^^_iri :- "foo"^^bar.

%tst12 :- write(tst12)@_plg,
	// this insert is just to test the compiler
	insert{%"foo"^^bar,"foo"^^bar},
	insertrule{(%"http://www.w3.org/2003/11/swrlb#add"^^_iri :- %"foo"^^bar),
	("http://www.w3.org/2003/11/swrlb#add"^^_iri :- "foo"^^bar)},
	if (%"http://www.w3.org/2003/11/swrlb#add"^^_iri,
	    "http://www.w3.org/2003/11/swrlb#add"^^_iri,
	    %"http://www.w3.org/2003/11/swrlb#add"^^_iri,
	    "http://www.w3.org/2003/11/swrlb#add"^^_iri)
        then writeln(' ok')@_plg
        else writeln(' bummer')@_plg.




%pretest :- %tst1, %tst2 and %tst3 and %tst4,
	    %tst5, %tst6, %tst7, %tst8, %tst9,
	    %tst10, %tst11, %tst12.

%test :-
	tell(temp)@_plg(),
	Method[mustDefine(on)]@_sys,
	%pretest,
	Method[mustDefine(off)]@_sys,
	%pretest,
	told@_plg().

