#include "standard.h"

%pretest :-
	set_test_mode(cranial)@_plg(flrtesting),
	(_compile(cranial_data) -->> true
        ; true
        ).
/*
	flora_read_then_parse_file('cranial_data.flr',?_X,?_Y)@_plg(flrutils),
	(flora_running_as(flora2)@_plg(flrporting) -->> true
	; to_Cranial_list(?_X,?_Heads,?_H2Bs)@_plg(flrparser),
	  flwrite_cranial(?_Heads,?_H2Bs)@_plg(flrparser)
        ).
*/


%test :-
	(File[exists(cranial_old)]@_io -->> File[unlink(cranial_old)]@_io;true),
	(flora_running_as(flora2)@_plg(flrporting) -->>
	    File[link(cranial_flora_old,cranial_old)]@_io
	;  File[link(cranial_ergo_old,cranial_old)]@_io
        ),
	file_reopen(temp1,w,STDERR,?_)@_plg(file_io),
	file_reopen(temp2,w,STDWARN,?_)@_plg(file_io),
	tell(temp)@_plg(),
        %pretest,
        told@_plg(),
	{STDWARN,STDERR}[close]@_io,
	temp[open(append,?Port0)]@_io,
	temp1[open(read,?Port1)]@_io,
	temp2[open(read,?Port2)]@_io,
	copyIOport({?Port1,?Port2},?Port0)@_plg(file_io),
	{?Port0,?Port1,?Port2}[close]@_io,
	File[unlink({temp1,temp2})]@_io.
