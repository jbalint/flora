#include "standard.h"

%pretest :-
	flora_read_then_parse_file('tnf_data.flr',?_X,?_Y)@_plg(flrutils),
	flwritelinelist(?_X)@_plg(flrparser).


%test :-
	(File[exists(tnf_old)]@_io -->> File[unlink(tnf_old)]@_io; true),
	(flora_running_as(flora2)@_plg(flrporting) -->>
	    File[link(tnf_flora_old,tnf_old)]@_io
	;  File[link(tnf_ergo_old,tnf_old)]@_io
        ),
	file_reopen(temp1,w,STDERR,?_)@_plg(file_io),
	file_reopen(temp2,w,STDWARN,?_)@_plg(file_io),
	tell(temp)@_plg(),
        %pretest,
        told@_plg(),
	{STDWARN,STDERR}[close]@_io,
	temp[open(append,?Port0)]@_io,
	temp1[open(read,?Port1)]@_io,
	temp2[open(read,?Port2)]@_io,
	copyIOport({?Port1,?Port2},?Port0)@_plg(file_io),
	{?Port0,?Port1,?Port2}[close]@_io,
	File[unlink({temp1,temp2})]@_io.
